<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top 3 Reborn Item Lists Calculator V2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f7f7f7;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2196f3; /* Blue */
        }
        .input-group {
            margin-bottom: 25px;
            text-align: center;
            border: 1px dashed #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        select, button, input[type="number"] {
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            box-sizing: border-box;
        }
        select {
            width: 100%;
            max-width: 350px;
            border: 1px solid #ccc;
        }
        input[type="number"] {
            width: 150px;
            text-align: center;
            border: 1px solid #ff9800; /* Orange */
        }
        button {
            background-color: #ff9800; /* Orange */
            color: white;
            border: none;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #fb8c00;
        }
        #warning {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
        #results {
            margin-top: 30px;
        }
        .solution {
            border: 2px solid #b3e5fc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #e1f5fe; /* Light Blue Background */
        }
        .solution h2 {
            color: #03a9f4; 
            margin-top: 0;
            border-bottom: 2px solid #03a9f4;
            padding-bottom: 5px;
        }
        .deviation {
            font-size: 1.1em;
            font-weight: bold;
            color: #d32f2f; /* Red */
        }
        .item-list {
            list-style: disc;
            padding-left: 20px;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .stats-table th, .stats-table td {
            border: 1px solid #eee;
            padding: 8px;
            text-align: left;
        }
        .stats-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .perfect-match {
            color: #4CAF50; /* Green */
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Super Item List Optimizer V2 (Flexible Search) üîç</h1>
    <p style="text-align: center;">Finds the **Top 3** closest solutions where items can be used multiple times.</p>

    <div class="input-group">
        <label for="superstitiousItemSelect">1. Select Target Superstitious Item:</label>
        <select id="superstitiousItemSelect">
            </select>
        
        <label for="maxItemsInput" style="margin-top: 15px;">2. Set Maximum Total Items to Search (Max $N$):</label>
        <input type="number" id="maxItemsInput" value="7" min="1" max="10" title="The search space grows exponentially! Keep this low (5-7) to avoid crashing.">
        
        <button onclick="findTopSolutions()">3. Find Top 3 Lists</button>
        <p id="warning">WARNING: High values (above 10) will take extremely long and likely crash the browser due to the exponential search complexity.</p>
        <p id="search-status" style="margin-top: 10px; color: #1e88e5;"></p>
    </div>

    <div id="results">
        <p>Select an item, set the Max Item Count, and click 'Find Top 3 Lists'.</p>
    </div>
</div>

<script>
    // --- ITEM DATA EMBEDDED FROM FILES ---
    // Note: The items you listed (Midas Blaster components) are not in the uploaded RebornItems.txt,
    // so this calculator can only use the 26 items listed below.
    const rebornItems = JSON.parse(`{"Precursor Furnace":{"Earth":0,"Aether":10,"Order":5,"Fire":-5,"Entropy":3,"Water":0},"Vulcan's Grasp":{"Earth":0,"Aether":3,"Order":5,"Fire":10,"Entropy":0,"Water":-5},"Pilotite Mine":{"Earth":3,"Aether":5,"Order":2,"Fire":-2,"Entropy":0,"Water":0},"Combustion Engine":{"Earth":0,"Aether":2,"Order":0,"Fire":5,"Entropy":3,"Water":-2},"Timeless Enhancement":{"Earth":3,"Aether":2,"Order":5,"Fire":0,"Entropy":-2,"Water":0},"The Fracture":{"Earth":3,"Aether":2,"Order":-2,"Fire":0,"Entropy":5,"Water":0},"Solar Flare":{"Earth":0,"Aether":3,"Order":2,"Fire":5,"Entropy":0,"Water":-2},"Sage Redeemer":{"Earth":2,"Aether":0,"Order":3,"Fire":-2,"Entropy":0,"Water":5},"Gravitational Gearwork":{"Earth":-2,"Aether":5,"Order":3,"Fire":2,"Entropy":0,"Water":0},"Dreamer's Fright":{"Earth":3,"Aether":0,"Order":-2,"Fire":2,"Entropy":5,"Water":0},"Crystal Shrine":{"Earth":10,"Aether":-5,"Order":5,"Fire":3,"Entropy":0,"Water":0},"Aether Refinery":{"Earth":2,"Aether":5,"Order":3,"Fire":0,"Entropy":-2,"Water":0},"Dreamer's Anguish":{"Earth":3,"Aether":0,"Order":-2,"Fire":2,"Entropy":5,"Water":0},"The Sporest":{"Earth":5,"Aether":0,"Order":0,"Fire":-2,"Entropy":3,"Water":1},"Morning Star":{"Earth":0,"Aether":3,"Order":0,"Fire":5,"Entropy":2,"Water":-2},"Atlantic Monolith":{"Earth":3,"Aether":0,"Order":2,"Fire":-2,"Entropy":0,"Water":5},"Righteous Will":{"Earth":2,"Aether":3,"Order":5,"Fire":0,"Entropy":-2,"Water":0},"The Abomination":{"Earth":3,"Aether":0,"Order":-2,"Fire":0,"Entropy":5,"Water":2},"Scorpium Mine":{"Earth":3,"Aether":0,"Order":0,"Fire":5,"Entropy":2,"Water":-2},"Green Tea Latte":{"Earth":3,"Aether":0,"Order":0,"Fire":-2,"Entropy":2,"Water":5},"Nova Star":{"Earth":0,"Aether":5,"Order":0,"Fire":10,"Entropy":3,"Water":-5},"Newtonic Corroder":{"Earth":3,"Aether":0,"Order":0,"Fire":-2,"Entropy":5,"Water":2},"Big Bad Blaster":{"Earth":0,"Aether":2,"Order":0,"Fire":5,"Entropy":3,"Water":-2},"Dreamer's Might":{"Earth":3,"Aether":0,"Order":5,"Fire":0,"Entropy":-2,"Water":2},"Vortex Chamber":{"Earth":-2,"Aether":5,"Order":2,"Fire":0,"Entropy":3,"Water":0},"Cooling Chamber":{"Earth":-2,"Aether":5,"Order":0,"Fire":3,"Entropy":0,"Water":2},"Son of Poison":{"Earth":5,"Aether":-5,"Order":0,"Fire":0,"Entropy":10,"Water":3},"Blind Justice":{"Earth":3,"Aether":0,"Order":5,"Fire":-2,"Entropy":2,"Water":0},"Skyliner Flux":{"Earth":-2,"Aether":5,"Order":3,"Fire":0,"Entropy":0,"Water":0},"Nuclear Stronghold":{"Earth":0,"Aether":-2,"Order":0,"Fire":2,"Entropy":5,"Water":3},"Black Dwarf":{"Earth":3,"Aether":5,"Order":0,"Fire":-5,"Entropy":10,"Water":0},"Flaming Schrodinger":{"Earth":2,"Aether":0,"Order":0,"Fire":5,"Entropy":3,"Water":-2},"Guardian of the Gate":{"Earth":3,"Aether":0,"Order":5,"Fire":-2,"Entropy":2,"Water":0},"Hades' Palace":{"Earth":0,"Aether":0,"Order":3,"Fire":10,"Entropy":5,"Water":-5},"Pizza Blaster":{"Earth":0,"Aether":3,"Order":2,"Fire":5,"Entropy":0,"Water":-2},"Precursor Mine":{"Earth":0,"Aether":10,"Order":5,"Fire":-5,"Entropy":3,"Water":0},"Big Bertha":{"Earth":-2,"Aether":3,"Order":2,"Fire":0,"Entropy":5,"Water":0},"Esoteric Citadel":{"Earth":1,"Aether":-1,"Order":3,"Fire":1,"Entropy":3,"Water":-2},"Railgun Cannon":{"Earth":0,"Aether":3,"Order":0,"Fire":5,"Entropy":1,"Water":-2},"Fractured Reality":{"Earth":0,"Aether":1,"Order":5,"Fire":-2,"Entropy":3,"Water":0},"Gravitational Gyrocopter":{"Earth":3,"Aether":0,"Order":-5,"Fire":0,"Entropy":10,"Water":5},"Quaint Skymill":{"Earth":0,"Aether":3,"Order":5,"Fire":0,"Entropy":-2,"Water":2},"Northern Lights":{"Earth":0,"Aether":5,"Order":3,"Fire":-5,"Entropy":0,"Water":10},"Toxic Waste Disposal":{"Earth":2,"Aether":0,"Order":-2,"Fire":0,"Entropy":5,"Water":3},"Apollium Mine":{"Earth":0,"Aether":5,"Order":0,"Fire":10,"Entropy":3,"Water":-5},"Red Giant":{"Earth":0,"Aether":3,"Order":0,"Fire":5,"Entropy":2,"Water":-2},"Invasive Cyberlord":{"Earth":0,"Aether":2,"Order":0,"Fire":3,"Entropy":5,"Water":-2},"Eternal Journey":{"Earth":3,"Aether":2,"Order":-2,"Fire":0,"Entropy":5,"Water":0},"Dreamer's Blight":{"Earth":3,"Aether":0,"Order":-5,"Fire":0,"Entropy":10,"Water":5},"Atomium Mine":{"Earth":3,"Aether":-2,"Order":5,"Fire":0,"Entropy":2,"Water":0},"Wild Spore":{"Earth":3,"Aether":2,"Order":0,"Fire":-2,"Entropy":5,"Water":0},"Father of Freon":{"Earth":0,"Aether":5,"Order":0,"Fire":-5,"Entropy":3,"Water":10},"Sword God Shrine":{"Earth":0,"Aether":5,"Order":-5,"Fire":3,"Entropy":10,"Water":0},"Frozen Justice":{"Earth":0,"Aether":2,"Order":3,"Fire":-2,"Entropy":0,"Water":5},"Phase Refiner":{"Earth":2,"Aether":5,"Order":3,"Fire":0,"Entropy":0,"Water":-2},"Newtonium Mine":{"Earth":3,"Aether":2,"Order":0,"Fire":-2,"Entropy":5,"Water":0},"Vampire Spore":{"Earth":3,"Aether":0,"Order":0,"Fire":5,"Entropy":10,"Water":-5},"Ore Illuminator":{"Earth":-2,"Aether":2,"Order":5,"Fire":0,"Entropy":3,"Water":0},"Blue Supergiant":{"Earth":0,"Aether":5,"Order":0,"Fire":10,"Entropy":3,"Water":-5},"Frigid Dystopia":{"Earth":0,"Aether":3,"Order":0,"Fire":-5,"Entropy":5,"Water":10},"Industrial Scarab":{"Earth":2,"Aether":0,"Order":0,"Fire":-2,"Entropy":5,"Water":3},"Tesla Resetter":{"Earth":0,"Aether":5,"Order":3,"Fire":0,"Entropy":2,"Water":-2},"Desert Monument":{"Earth":3,"Aether":0,"Order":0,"Fire":5,"Entropy":1,"Water":-2},"Big Alberto":{"Earth":3,"Aether":5,"Order":0,"Fire":0,"Entropy":10,"Water":-5},"Phase Processor":{"Earth":2,"Aether":5,"Order":3,"Fire":0,"Entropy":0,"Water":-2},"Venomshank":{"Earth":3,"Aether":0,"Order":-2,"Fire":0,"Entropy":5,"Water":2},"Dragon Blaster":{"Earth":0,"Aether":3,"Order":0,"Fire":10,"Entropy":5,"Water":-5},"Ancient Temple":{"Earth":5,"Aether":2,"Order":3,"Fire":-2,"Entropy":0,"Water":0},"The Catalyst":{"Earth":-2,"Aether":2,"Order":3,"Fire":5,"Entropy":0,"Water":0},"Scorching Heat":{"Earth":2,"Aether":0,"Order":0,"Fire":5,"Entropy":3,"Water":-2},"Ore Skillet":{"Earth":0,"Aether":3,"Order":2,"Fire":5,"Entropy":0,"Water":-2},"Lightningbolt Refiner":{"Earth":0,"Aether":5,"Order":0,"Fire":-2,"Entropy":2,"Water":3},"Breech Loader":{"Earth":3,"Aether":5,"Order":2,"Fire":0,"Entropy":-2,"Water":0},"Igneous Forge":{"Earth":5,"Aether":0,"Order":0,"Fire":10,"Entropy":3,"Water":-5},"Massive Diamond Mine":{"Earth":5,"Aether":0,"Order":2,"Fire":3,"Entropy":-2,"Water":0},"Yunium Mine":{"Earth":3,"Aether":2,"Order":-2,"Fire":0,"Entropy":0,"Water":5},"Stardust Pulsar":{"Earth":0,"Aether":10,"Order":0,"Fire":5,"Entropy":3,"Water":-5},"Quantum Ore Cleaner":{"Earth":-2,"Aether":5,"Order":3,"Fire":0,"Entropy":0,"Water":2},"Crystallized System":{"Earth":5,"Aether":0,"Order":3,"Fire":2,"Entropy":0,"Water":-2},"Spirit of Fire":{"Earth":0,"Aether":3,"Order":0,"Fire":10,"Entropy":5,"Water":-5},"Symmetrium Mine":{"Earth":3,"Aether":0,"Order":2,"Fire":-2,"Entropy":0,"Water":5},"Arcane Lightning":{"Earth":0,"Aether":10,"Order":0,"Fire":-5,"Entropy":3,"Water":5},"Mineral Wheel":{"Earth":5,"Aether":0,"Order":2,"Fire":0,"Entropy":-2,"Water":3},"Shard Park":{"Earth":5,"Aether":2,"Order":3,"Fire":0,"Entropy":0,"Water":-2},"Astral Predictor":{"Earth":-2,"Aether":5,"Order":2,"Fire":0,"Entropy":0,"Water":3},"Palladium Drill":{"Earth":10,"Aether":0,"Order":0,"Fire":3,"Entropy":5,"Water":-5},"Ambrosia Fountain":{"Earth":3,"Aether":5,"Order":0,"Fire":-2,"Entropy":0,"Water":2},"Dragonglass Mine":{"Earth":3,"Aether":0,"Order":-2,"Fire":2,"Entropy":5,"Water":0},"Sakura Garden":{"Earth":5,"Aether":2,"Order":0,"Fire":-2,"Entropy":0,"Water":3},"Ore Sawmill":{"Earth":0,"Aether":2,"Order":3,"Fire":-2,"Entropy":5,"Water":0},"Plasma Scanner":{"Earth":-2,"Aether":2,"Order":0,"Fire":5,"Entropy":3,"Water":0},"Gate of Eclipse":{"Earth":0,"Aether":2,"Order":3,"Fire":-2,"Entropy":5,"Water":0},"Virtual Enhancer":{"Earth":5,"Aether":3,"Order":10,"Fire":0,"Entropy":-5,"Water":0},"Dark Magic":{"Earth":0,"Aether":3,"Order":2,"Fire":-2,"Entropy":5,"Water":0},"Industrial Firecrystal Mine":{"Earth":3,"Aether":0,"Order":0,"Fire":5,"Entropy":2,"Water":-2},"Clockwork":{"Earth":-2,"Aether":3,"Order":5,"Fire":0,"Entropy":2,"Water":0},"Azure Refiner":{"Earth":5,"Aether":0,"Order":2,"Fire":-2,"Entropy":0,"Water":3},"Nature's Grip":{"Earth":5,"Aether":3,"Order":2,"Fire":0,"Entropy":-2,"Water":0}}`);

    const superstitiousItems = JSON.parse(`{"Elysium Solemnity":{"Earth":15,"Aether":65,"Order":130,"Fire":35,"Entropy":35,"Water":20},"Meralin's Sorcery":{"Earth":75,"Aether":75,"Order":75,"Fire":75,"Entropy":75,"Water":75},"Daestrophe":{"Earth":40,"Aether":0,"Order":0,"Fire":95,"Entropy":145,"Water":45},"Swag City":{"Earth":75,"Aether":50,"Order":25,"Fire":75,"Entropy":100,"Water":25},"The Heart of Void":{"Earth":170,"Aether":90,"Order":25,"Fire":50,"Entropy":250,"Water":50},"Ore Hypernova":{"Earth":10,"Aether":200,"Order":25,"Fire":50,"Entropy":100,"Water":0},"Methuselah's Mask":{"Earth":100,"Aether":50,"Order":50,"Fire":50,"Entropy":150,"Water":50},"The Death Cap":{"Earth":50,"Aether":35,"Order":5,"Fire":15,"Entropy":125,"Water":20},"Pandora's Box":{"Earth":35,"Aether":35,"Order":12,"Fire":80,"Entropy":130,"Water":12},"Havium Mine":{"Earth":130,"Aether":40,"Order":50,"Fire":25,"Entropy":0,"Water":0},"Enchanted Library":{"Earth":20,"Aether":75,"Order":175,"Fire":0,"Entropy":20,"Water":10},"Draedon's Gauntlet":{"Earth":10,"Aether":130,"Order":50,"Fire":0,"Entropy":20,"Water":20},"Delta Phantom":{"Earth":35,"Aether":65,"Order":0,"Fire":0,"Entropy":130,"Water":55},"Midas Blaster":{"Earth":100,"Aether":0,"Order":25,"Fire":50,"Entropy":25,"Water":0},"Optic Origin":{"Earth":0,"Aether":50,"Order":100,"Fire":25,"Entropy":25,"Water":0},"Garden of Gaia":{"Earth":150,"Aether":45,"Order":45,"Fire":5,"Entropy":10,"Water":80},"Tyrant's Throne":{"Earth":50,"Aether":10,"Order":130,"Fire":25,"Entropy":20,"Water":0},"Vulcan's Wrath":{"Earth":40,"Aether":35,"Order":5,"Fire":125,"Entropy":55,"Water":0},"The Hourglass":{"Earth":50,"Aether":200,"Order":200,"Fire":50,"Entropy":100,"Water":50}}`);

    const elementalStats = ["Earth", "Aether", "Order", "Fire", "Entropy", "Water"];
    const rebornItemNames = Object.keys(rebornItems);

    /**
     * Initializes the dropdown menu.
     */
    function init() {
        const select = document.getElementById('superstitiousItemSelect');
        for (const name in superstitiousItems) {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
        }
        if (select.options.length > 0) {
            select.selectedIndex = 0;
        }
    }

    /**
     * Recursively searches for item combinations up to MAX_ITEMS.
     */
    function findTopSolutions() {
        const targetName = document.getElementById('superstitiousItemSelect').value;
        const targetStats = superstitiousItems[targetName];
        const maxItems = parseInt(document.getElementById('maxItemsInput').value);
        const statusDiv = document.getElementById('search-status');
        const resultsDiv = document.getElementById('results');
        
        if (!targetStats || isNaN(maxItems) || maxItems < 1 || maxItems > 15) {
            resultsDiv.innerHTML = '<p style="color:red;">Please select an item and set a valid Max Item Count (1-15).</p>';
            return;
        }

        let bestSolutions = []; 
        let searchCount = 0;

        function calculateDeviation(combinedStats) {
            let ssd = 0;
            for (const stat of elementalStats) {
                const diff = targetStats[stat] - combinedStats[stat];
                ssd += diff * diff;
            }
            return ssd;
        }

        // Optimized way to get a unique key for a combination that handles order and duplicates
        function getCombinationKey(currentList) {
            // Count occurrences of each item and create a sorted string
            const counts = currentList.reduce((acc, item) => {
                acc[item] = (acc[item] || 0) + 1;
                return acc;
            }, {});
            
            return Object.entries(counts)
                .sort(([nameA], [nameB]) => nameA.localeCompare(nameB))
                .map(([name, count]) => `${name}:${count}`)
                .join('|');
        }


        // Recursive search function (depth-first search)
        function recursiveSearch(currentList, currentCombinedStats, depth) {
            if (depth > maxItems) return;
            searchCount++;
            
            // Check current solution
            if (depth > 0) {
                const deviation = calculateDeviation(currentCombinedStats);
                const key = getCombinationKey(currentList);

                // Check if this key is already in the best solutions list
                const existingIndex = bestSolutions.findIndex(sol => sol.key === key);

                if (existingIndex === -1) {
                    // New unique solution
                    bestSolutions.push({
                        deviation: deviation,
                        combination: currentList,
                        combinedStats: currentCombinedStats,
                        key: key
                    });
                } else if (deviation < bestSolutions[existingIndex].deviation) {
                    // Update existing solution if better
                    bestSolutions[existingIndex].deviation = deviation;
                }

                // Keep only the top 10 unique solutions to manage memory during the search
                bestSolutions.sort((a, b) => a.deviation - b.deviation);
                if (bestSolutions.length > 10) { 
                    bestSolutions = bestSolutions.slice(0, 10);
                }
            }


            // Continue searching by adding one more item
            // Optimization: Only try adding items that are alphabetically >= the last item added. 
            // This prevents generating redundant permutations (e.g., [A, B] and [B, A]).
            const startItem = currentList.length > 0 ? currentList[currentList.length - 1] : rebornItemNames[0];

            for (const item of rebornItemNames) {
                // This check enforces ordered addition for combination (not permutation)
                // Note: since we are tracking item *counts* in the key, simple permutation is fine, 
                // but the alphabetical check is a small optimization to skip redundant search paths.
                if (item < startItem && currentList.length > 0) continue; 
                
                const itemStats = rebornItems[item];
                let nextCombinedStats = {...currentCombinedStats};

                for (const stat of elementalStats) {
                    nextCombinedStats[stat] = (currentCombinedStats[stat] || 0) + itemStats[stat];
                }
                
                // Set the current status every 50,000 checks
                if (searchCount % 50000 === 0) {
                     statusDiv.textContent = `Searching... Items: ${depth} of ${maxItems}. Checks performed: ${searchCount.toLocaleString()}.`;
                }

                // Recurse
                recursiveSearch(
                    [...currentList, item], 
                    nextCombinedStats, 
                    depth + 1
                );
            }
        }
        
        // --- Start Search ---
        statusDiv.textContent = `Search initialized. Max items: ${maxItems}.`;
        resultsDiv.innerHTML = '<p style="text-align: center;">Calculating...</p>';
        const startTime = Date.now();
        
        // Start the search from a base of no items (depth 0)
        const initialStats = elementalStats.reduce((acc, stat) => {acc[stat] = 0; return acc;}, {});
        recursiveSearch([], initialStats, 0);


        const endTime = Date.now();
        const searchTime = ((endTime - startTime) / 1000).toFixed(2);
        
        statusDiv.textContent = `Search complete in ${searchTime} seconds. Total paths checked: ${searchCount.toLocaleString()}. Displaying top ${Math.min(3, bestSolutions.length)} solutions.`;
        
        // Display the top 3 (or fewer if less than 3 were found)
        displayTopSolutions(targetName, targetStats, bestSolutions.slice(0, 3));
    }


    /**
     * Renders the top solutions to the results div.
     */
    function displayTopSolutions(targetName, targetStats, topSolutions) {
        const resultsDiv = document.getElementById('results');
        let html = `<h2>Target Superstitious Item: ${targetName}</h2>`;

        if (topSolutions.length === 0) {
            html += '<p>No combinations found up to the maximum item limit. Try increasing the Max Item Count (use caution!).</p>';
            resultsDiv.innerHTML = html;
            return;
        }

        topSolutions.forEach((solution, index) => {
            const isPerfect = solution.deviation === 0;
            const rank = index + 1;

            // Count occurrences of each item in the list
            const itemCounts = solution.combination.reduce((acc, item) => {
                acc[item] = (acc[item] || 0) + 1;
                return acc;
            }, {});
            
            const itemList = Object.entries(itemCounts)
                .sort(([nameA], [nameB]) => nameA.localeCompare(nameB))
                .map(([name, count]) => `<li>${name} x${count}</li>`)
                .join('');
            
            // Create stats comparison table
            let statsTable = `
                <table class="stats-table">
                    <tr>
                        <th>Element</th>
                        <th>Target (${targetName})</th>
                        <th>Combination Total</th>
                        <th>Difference (T - C)</th>
                    </tr>
            `;
            for (const stat of elementalStats) {
                const target = targetStats[stat];
                const combined = solution.combinedStats[stat] || 0; // Handle initial empty set
                const diff = target - combined;
                const diffClass = isPerfect ? 'perfect-match' : (diff === 0 ? 'perfect-match' : 'deviation');

                statsTable += `
                    <tr>
                        <td>${stat}</td>
                        <td>${target}</td>
                        <td>${combined}</td>
                        <td class="${diffClass}">${diff > 0 ? '+' : ''}${diff}</td>
                    </tr>
                `;
            }
            statsTable += `</table>`;


            html += `
                <div class="solution">
                    <h2>#${rank} Best Match (${solution.combination.length} items total)</h2>
                    <p>
                        <strong>Total Deviation (Sum of Squared Differences):</strong> 
                        <span class="deviation">${solution.deviation.toFixed(2)}</span>
                        ${isPerfect ? '<span class="perfect-match"> (PERFECT MATCH!)</span>' : ''}
                    </p>
                    
                    <h3>Item List:</h3>
                    <ul class="item-list">${itemList}</ul>
                    
                    <h3>Stat Comparison:</h3>
                    ${statsTable}
                </div>
            `;
        });

        resultsDiv.innerHTML = html;
    }

    window.onload = init;
</script>

</body>
</html>
